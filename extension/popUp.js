document.addEventListener('DOMContentLoaded', () => {
    const checkUrlButton = document.getElementById('checkUrl');
    const popup = document.getElementById('popup');
    const overlay = document.getElementById('overlay');
    const popupClose = document.getElementById('popupClose');
    const predictionText = document.getElementById('predictionText');

    checkUrlButton.addEventListener('click', () => {
        chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
            const currentTab = tabs[0];
            if (currentTab && currentTab.url) {
                checkUrl(currentTab.url);
            }
        });
    });

    popupClose.addEventListener('click', () => {
        closePopup();
    });

    overlay.addEventListener('click', () => {
        closePopup();
    });


    function checkUrl(url) {
        fetch('http://localhost:7000/api/predict', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ url: url })
        })
        .then(response => response.json())
        .then(data => {
            if (data.result === 'malicious') {
                chrome.runtime.sendMessage({ type: 'educationalContent', result: 'malicious', url: url });
                predictionText.textContent = `The URL ${url} is malicious!`;
            } else {
                chrome.runtime.sendMessage({ type: 'educationalContent', result: 'benign', url: url });
                predictionText.textContent = `The URL ${url} is safe.`;
            }
        })
        .catch(error => console.error('Error:', error));
    }

    function closePopup() {
        popup.style.display = 'none';
        overlay.style.display = 'none';
    }
});

// These codes where gotten from philomathic, source -- https://github.com/philomathic-guy/Malicious-Web-Content-Detection-Using-Machine-Learning/blob/master/features_extraction.py
